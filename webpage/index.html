<html>
  
  <head>
    <title>The Undying Carpet</title>
	<style>
	#body{
		padding:0;
		margin:0;
	}
	.lengthSelector{
		width:100%;
		background:#F66;
		height:150px;
		
		cursor:pointer;
	}
	.graphVisu{
		background:#6F6;
	}
	.playingBar{
		position:relative;
		background:#66F;
		width:3px;
		height:100%;
	}
	.visuBar{
		background:#F6F;
	}
	
	.comments{
		position:relative;
		height:50px;
		background:#EEE;
	}
	
	.comment{
		height:60px;
		width:200px;
		position:absolute;
		top:-5px;
	}
	
	.pointer, .comContent{
		display:inline-block;
		vertical-align:top;
		
	}
	
	.pointer{
		width:20px;
		margin:20px 0;
		background:#FF6;
		height:20px;
	}
	
	.comContent{
		display:none;
		width:170px;
		background:#F6F;
		height:100%;
		
	}
	
	.comment:hover .comContent{
		display:inline-block;
	}

	.headerContent, .headerButtons{
		float:left;
	}
	
	.headerButtons{
		width:50px;
		height:100%;
	}
	
	.headerContent{
		width:calc(100% - 55px);
	}
	
	.header{
		height:200px;
		overflow:hidden;
		
		width:100%;
		
			/* For Safari 3.1 to 6.0 */
			-webkit-transition-property: height;
			-webkit-transition-duration: 0.2s;
			-webkit-transition-timing-function: linear;
			/* Standard syntax */
			transition-property: height;
			transition-duration: 0.2s;
			transition-timing-function: linear;
	}
	
	.head{
		position:fixed;
		width:100%;
	}
	
	</style>
    <script type="text/javascript">
        // Global variable to track current file name.
        var currentFile = "demo.mp3";
		var inited = false;	// I hereby declare inited as being a real word of the english language. Shakespeare style
		var graphOpen = false;
		
		function initAudio(){
			var oAudio = document.getElementById('audioTag');
			oAudio.src = currentFile;
			oAudio.addEventListener("timeupdate", progressChecking, true);
		}
		
        function toggleAudio() {
			if(!inited){
				initAudio();
				inited = true;
			}
            // Check for audio element support.
            if (window.HTMLAudioElement) {
                try {
                    var oAudio = document.getElementById('audioTag');
                    var btn = document.getElementById('play'); 

                    if (oAudio.paused) {
                        oAudio.play();
                        btn.textContent = "Pause";
                    }
                    else {
                        oAudio.pause();
                        btn.textContent = "Play";
                    }
					
					oAudio.addEventListener("timeupdate", progressChecking, true);
                }
                catch (e) {
                     if(window.console && console.error("Error:" + e));
                }
            }
        }
		
		function gotoAudio(event){
			var offset = 0;
			var totalWidth = window.document.getElementById("songVisualizer").clientWidth;
			var percent = (event.x - offset)/totalWidth;
			
			if (window.HTMLAudioElement) {
                try {
                    var oAudio = document.getElementById('audioTag');
                    oAudio.currentTime = percent*oAudio.duration;
                }
                catch (e) {
                    // Fail silently but show in F12 developer tools console
                     if(window.console && console.error("Error:" + e));
               }
            }
		}
		
		function progressChecking(){
			var oAudio = document.getElementById('audioTag');
			var totalWidth = window.document.getElementById("songVisualizer").clientWidth;
			var percent = oAudio.currentTime/oAudio.duration;
			
			var playingBars = document.getElementsByClassName('playingBar');
			for(var i=0;i<playingBars.length;i++){
			playingBars[i].setAttribute('style','left:'+percent*totalWidth+'px;');
			}
		}
		
		function toggleGraphs(){
			var headerHeight = 200;
			if(!graphOpen){
				headerHeight = 350;
			}
			graphOpen = !graphOpen;
			document.getElementsByClassName('header')[0].setAttribute('style','height:'+headerHeight+'px');
			
		}
		
    </script>
  </head>
  
  <body id="body">
	<div class="head">
	<div class="header">
		<div class="headerButtons">
			<audio id="audioTag">
			  Get a decent browser
			</audio>
			<button id="play" onclick="toggleAudio();">
			  Play
			</button>
		</div>
		<div class="headerContent">
			<div id="songVisualizer" class="lengthSelector" onclick="gotoAudio(event)">
			<div class="playingBar"></div>
			</div>
			<div class="comments">
			<div class="comment">
				<div class="pointer"></div>
				<div class="comContent"> Ok lol </div>
			</div>
			</div>
			<div id="graphsVisualizer" class="lengthSelector graphVisu" onclick="gotoAudio(event)">
				<div class="playingBar visuBar"></div>
			</div>
		</div>
	</div>
	<div>
		<button id="showGraphs" onclick="toggleGraphs();">
			I want graphz
		</button>
	</div>
	</div>
  </body>

</html>